@using BassinoLibrary.Helpers
@using BassinoLibrary.Resource
@using BassinoLibrary.ViewModels
@model BassinoLibrary.ViewModels.CreditoViewModel

@{
    Layout = "~/Views/Shared/_ModalLayout.cshtml";
    ViewBag.Action = "Amortizar";
}

@section Header
{
    @Helpers.ModalHeader(string.Format("{0} {1}", Resources.Create, "Credito"))
}

<fieldset>
    <div class="alert alert-success alert-dismissable">
        <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
        <h4><i class="icon fa fa-warning"></i> Alerta</h4>
        Al amortizar el prestamo ud estara reduciendo el valor de las cuotas.
    </div>
    @Html.ValidationSummary(true)
    @Html.HiddenFor(model => model.Id)
    @Html.PersonalDisplayFor(model => model.Descripcion)
    @Html.PersonalDisplayFor(model => model.ProductoDescripcion)
    @Html.PersonalDisplayFor(model => model.Cliente)
    @Html.PersonalDisplayFor(model => model.Monto)
    @Html.HiddenFor(model => model.Monto)
    @Html.PersonalDisplayFor(model => model.MontoTotal)
    @Html.HiddenFor(model => model.Interes)
    @Html.PersonalDisplayFor(model => model.Interes)
    @Html.PersonalDisplayFor(model => model.NumeroPagos)
    @Html.HiddenFor(model => model.NumeroPagos)
    @Html.PersonalSEditorFor(model => model.MontoAmortizar)
    <input type="hidden" id="UserId" name="UserId" value="@ViewBag.CreateUser">


    <input class="btn btn-primary" type="button" onclick="SimulateCoutas()" value="Simular" />
    <table id="tablaSimulada" style=" margin-top: 20px">
        <thead>
            <tr>
                <th>
                    Monto
                </th>
                <th>
                    Vencimmiento
                </th>
            </tr>
        </thead>
        <tbody></tbody>

    </table>

</fieldset>
<style>
    table {
        border-collapse: collapse;
    }

    table, td, th {
        border: 1px solid black;
        width: 50%;
    }
</style>
<script>
    function SimulateCoutas() {
        var cadena = "";
        var cantidad = $("#NumeroPagos").val();
        var interes = $("#Interes").val();
        var monto = $("#Monto").val();
        var montoAmortizar = $("#MontoAmortizar").val();
        $.ajax({
            type: "POST",
            url: "/Credito/SimularCuotasAmortizar",
            datatype: "JSON",
            data: { cantidad: cantidad, interes: interes, monto: monto, montoamortizar: montoAmortizar },
            success: function (data) {
                $.each(data, function (i, item) {
                    cadena = cadena + "<tr><td>" + item.cuota + "</td><td>" + item.fecha + "</td></tr>";
                });
                $('#tablaSimulada tbody').html(cadena);
            }
        });
    }

    function ProductSelect() {
        var monto = $("#ProductoId").val();
        $.ajax({
            type: "POST",
            url: "/Product/GetDataPrduct",
            datatype: "JSON",
            data: { text: monto },
            success: function (data) {
                $("#Monto").val(data.monto);
                $("#MontoTotal").val(data.monto);
                $("#Interes").val(0, 0);
                $("#Monto").prop('disabled', true);
                $("#MontoTotal").prop('disabled', true);
                $("#Interes").prop('disabled', true);

            }
        });
    }
</script>
@section Footer
{
    @Helpers.BotonesGuardarCancelarModal()
}
